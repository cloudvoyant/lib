# Migration Guide: v1.1.0 to v1.2.0

## Overview

- **Summary**: This release adds ADR (Architectural Decision Record) management capabilities and improves documentation validation. The validate-docs command is now general-purpose and can be used by all scaffolded projects.
- **Platform**: platform-lib
- **From Version**: 1.1.0
- **To Version**: 1.2.0
- **Date**: 2025-10-11

## Breaking Changes

**No breaking changes** - This is a feature release with backward compatibility.

## New Features

### ADR Management System

- **New Command: `/new-decision`**: Interactively create Architectural Decision Records
  - Guides through decision-making process
  - Researches context and options
  - Presents alternatives with pros/cons
  - Creates properly formatted ADRs
  - Supports WIP (Work In Progress) status

- **New Command: `/capture-decisions`**: Capture decisions from conversation history
  - Analyzes session for key decisions
  - Identifies technology, architecture, and process choices
  - Generates ADR files automatically
  - Updates ADR index

- **ADR Documentation**: Added 11 foundational ADRs documenting platform design decisions
  - `docs/decisions/` directory with comprehensive ADR index
  - Documents rationale for just, .envrc, bash, CI/CD, and other core choices

### Documentation Validation Improvements

- **General-Purpose `/validate-docs`**: Now available for all projects (not just platform development)
  - Checks documentation structure
  - Validates internal links
  - Verifies code examples match actual project
  - Checks version references
  - Finds TODOs and placeholders
  - **New**: Validates documentation consistency with project files
  - **New**: Verifies documented commands actually exist

### Claude Code Instructions

- **Git Commit Guidelines**: Added explicit rules forbidding self-attribution in commits
- **Testing Guidelines**: Added instructions for proper test environment setup
  - Always use `just platform-test`
  - Run `direnv allow` before testing
  - Explains why environment variables matter

### Documentation Improvements

- **Comprehensive User Guide**: New `docs/user-guide.md` consolidating setup and usage instructions
- **ADR Style Guide**: Added `.claude/style.md` with ADR templates and conventions
- **Enhanced Setup Script**: Improved `scripts/setup.sh` with better error handling

### Code Quality

- **Consolidated Tests**: Streamlined test suite in `test/scaffold.bats` and `test/template-export.bats`
- **Improved Scaffold Script**: Enhanced string replacement and error handling in `scripts/scaffold.sh`

## Migration Steps

### Automatic Migration

No automated migration is required. This is a non-breaking feature release.

### Manual Steps

#### Step 1: Update Platform Version

If you're tracking platform version in your project's `.envrc`:

```bash
# Update the platform version
sed -i 's/NV_PLATFORM_VERSION=1.1.0/NV_PLATFORM_VERSION=1.2.0/' .envrc
```

#### Step 2: Pull New Commands (Optional)

If you want the new ADR management commands in your scaffolded project:

```bash
# Copy new Claude commands to your project
cp path/to/platform/.claude/commands/new-decision.md .claude/commands/
cp path/to/platform/.claude/commands/capture-decisions.md .claude/commands/
cp path/to/platform/.claude/commands/validate-docs.md .claude/commands/

# Copy ADR style guide
cp path/to/platform/.claude/style.md .claude/
```

#### Step 3: Initialize ADR Directory (Optional)

If you want to use ADRs in your project:

```bash
# Create ADR directory structure
mkdir -p docs/decisions

# Create ADR index
cat > docs/decisions/README.md << 'EOF'
# Architectural Decision Records

This directory contains Architectural Decision Records (ADRs) documenting significant design choices.

## Index

<!-- ADRs will be listed here -->

## Creating New ADRs

Use the `/new-decision` command to create a new ADR interactively.
EOF
```

#### Step 4: Verify Changes

```bash
# Verify platform version updated
grep "NV_PLATFORM_VERSION" .envrc
# Should show: export NV_PLATFORM_VERSION=1.2.0

# Verify new commands are available (if you copied them)
ls .claude/commands/new-decision.md
ls .claude/commands/capture-decisions.md
ls .claude/commands/validate-docs.md
```

## Benefits of Upgrading

### For All Projects

- **Better Documentation Validation**: The improved `/validate-docs` command catches more inconsistencies
- **Project Consistency Checks**: Validates that documentation matches actual project structure

### For Platform Developers

- **ADR Management**: Professional decision documentation with guided workflows
- **Session Capture**: Automatically extract decisions from working sessions
- **Better Testing**: Clear guidelines prevent environment-related test failures

### For Teams

- **Decision History**: ADRs provide context for why choices were made
- **Onboarding**: New team members can understand architectural decisions
- **Knowledge Sharing**: Decisions are documented and searchable

## Rollback

If you need to rollback:

```bash
# Restore platform version
sed -i 's/NV_PLATFORM_VERSION=1.2.0/NV_PLATFORM_VERSION=1.1.0/' .envrc

# Remove new commands if you added them
rm .claude/commands/new-decision.md
rm .claude/commands/capture-decisions.md

# Keep validate-docs.md if you want - it's backward compatible
```

## Troubleshooting

### Common Issues

**Issue**: `/new-decision` command not found

- **Solution**: Make sure you copied the command file to `.claude/commands/new-decision.md` and it's in your Claude Code project

**Issue**: ADR directory not showing up

- **Solution**: Create `docs/decisions/` manually and add a README.md index file

**Issue**: validate-docs reports false positives

- **Solution**: The improved validator is stricter. Review the reported issues - they likely indicate real documentation drift

## Support

For questions or issues:

- Check the [platform documentation](../README.md)
- Review [architecture docs](../architecture.md)
- Review the new [user guide](../user-guide.md)
- Open an issue on GitHub

## Changelog

For detailed commit history, see the git log:
```bash
git log v1.1.0..v1.2.0
```
