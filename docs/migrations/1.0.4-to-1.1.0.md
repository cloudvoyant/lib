# Migration Guide: v1.0.4 to v1.1.0

## Overview

- **Summary**: Version 1.1.0 completes the project scaffolding functionality that was a placeholder in v1.0.4. This is a feature release with no breaking changes.
- **Platform**: yin
- **From Version**: 1.0.4
- **To Version**: 1.1.0
- **Date**: 2025-01-08

## What Changed

### New Features

1. **Complete Scaffold Implementation** (`scripts/scaffold.sh`)

   - Was: 18-line placeholder with TODO comments
   - Now: 420+ line full implementation with interactive/non-interactive modes
   - Enhanced string replacement with proper case conversion
   - Automatic backup and rollback on failure

2. **GitHub Template Support**

   - Added `export-ignore` attributes to `.gitattributes`
   - Enables clean project creation via GitHub's "Use this template" button
   - Platform development files automatically excluded from template exports
   - Tested with comprehensive template export validation (15 tests)

3. **Migration System**

   - Slash commands: `/upgrade`, `/new-migration`, `/new-platform`
   - Migration workflows for detecting versions and assisting upgrades
   - Migration guide template for documenting platform changes
   - Platform version tracking in `.envrc` (NV_PLATFORM, NV_PLATFORM_VERSION)

4. **Platform Development Tools**

   - New script: `scripts/platform-install.sh` - Installs bats, shellcheck
   - Justfile commands: `just platform-install`, `just platform-test`, `just new-migration`, `just new-platform`
   - Comprehensive test suite: 57 tests across 4 test files
     - `test/scaffold.bats` (31 tests)
     - `test/migration.bats` (19 tests)
     - `test/justfile-preservation.bats` (7 tests)
     - `test/template-export.bats` (15 tests)

5. **Template System**

   - `README.template.md` - For scaffolded project READMEs
   - Sample files for testing case replacements
   - Migration guide template (`docs/migrations/TEMPLATE.md`)

6. **Case-Aware Name Replacement**
   - Automatically converts project names to all formats (PascalCase, camelCase, snake_case, kebab-case, flatcase)
   - Properly handles multi-word project names

### Bug Fixes

- Enhanced error handling and automatic rollback in scaffold.sh
- Fixed platform dependency installation across different OS
- Improved string replacement ordering to prevent partial replacements

## Impact on Existing Projects

**None.** This is a non-breaking release.

If your project was scaffolded from v1.0.4, it will continue to work without any changes. The new features primarily benefit:

- **Platform developers** - Can now run tests and install deps easily
- **New projects** - Get better scaffolding experience
- **GitHub users** - Can use "Use this template" button for clean project creation

## Creating New Projects

There are now **two ways** to create new projects from this platform:

### Option 1: GitHub Template (Recommended for GitHub users)

1. Click "Use this template" on GitHub
2. Clone your new repository
3. Run the scaffold script to customize:
   ```bash
   bash scripts/scaffold.sh --src . --dest . --project your-project-name
   ```

Platform development files (tests, migrations, changelogs) are automatically excluded.

### Option 2: Nedavellir CLI (Automated)

The Nedavellir CLI handles everything automatically:

```bash
nv create your-project-name --platform yin
```

Both methods result in identical, clean project structures.

## Optional: Add Platform Tracking

If you want to track which platform version your project uses (enables future migrations):

**Add to `.envrc`:**

```bash
# Platform tracking (optional)
export NV_PLATFORM=yin
export NV_PLATFORM_VERSION=1.1.0
```

**Reload environment:**

```bash
direnv allow
```

This is entirely optional but recommended for future-proofing.

## For Platform Developers

If you're developing this platform itself:

### Install Development Dependencies

```bash
just platform-install
```

### Run Tests

```bash
just platform-test
```

Should show: `57 tests, 57 passing`

### Create Migration Guides

When releasing a new platform version:

```bash
just new-migration
# or: claude /new-migration
```

This generates a new migration guide from the template.

### Create New Platform from This Template

To create a new platform based on this one:

```bash
just new-platform
# or: claude /new-platform
```

### Test GitHub Template Export

Verify that `export-ignore` excludes platform files correctly:

```bash
bats test/template-export.bats
```

## No Action Required

**Existing scaffolded projects work as-is.** No migration steps needed.

## Support

- [Architecture docs](../architecture.md)
- [Design docs](../design.md)
- [GitHub Issues](https://github.com/cloudvoyant/lib/issues)
